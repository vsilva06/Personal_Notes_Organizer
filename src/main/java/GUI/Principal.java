package GUI;

import Complementos.FileSystemModel;
import Datos.GestorArchivos;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import java.io.File;


public class Principal extends JFrame implements ActionListener, MouseListener {
    private JPanel principal;
    private JTree tree1;
    private JMenuBar menuBar1;
    private JMenu opcionesMenu;
    private JMenuItem nuevaCarpeta, eliminarCarpeta, nuevaNota, eliminarNota;
    private TextEditor textEditor;
    private GestorArchivos gestorArchivos;
    private String ruta;


    public Principal(String s) {
        this.ruta = "src/main/resources/Usuarios/" + s.strip();
        ImageIcon logo = new ImageIcon("src/main/resources/Logo/Logo.png");
        $$$setupUI$$$();
        this.setTitle("PNO");
        this.add(principal);
        setSize(400, 500);
        agregarMenu();
        setLocationRelativeTo(null);
        this.setIconImage(logo.getImage());
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        // setResizable(false);
        pack();
        setVisible(true);


    }

    private void agregarMenu() {
        menuBar1 = new JMenuBar();
        setJMenuBar(menuBar1);

        opcionesMenu = new JMenu("Opciones");
        menuBar1.add(opcionesMenu);

        nuevaCarpeta = new JMenuItem("Nueva carpeta");
        nuevaCarpeta.addActionListener(this);
        opcionesMenu.add(nuevaCarpeta);

        eliminarCarpeta = new JMenuItem("Eliminar carpeta");
        eliminarCarpeta.addActionListener(this);
        opcionesMenu.add(eliminarCarpeta);

        nuevaNota = new JMenuItem("Nueva nota");
        nuevaNota.addActionListener(this);
        opcionesMenu.add(nuevaNota);

        eliminarNota = new JMenuItem("Eliminar nota");
        eliminarNota.addActionListener(this);
        opcionesMenu.add(eliminarNota);


        tree1.setModel(new FileSystemModel(new File(ruta)));
        tree1.addMouseListener(this);

        gestorArchivos = new GestorArchivos();


    }


    @Override
    public void actionPerformed(ActionEvent e) {
        String path = validarPath();

        if (e.getSource() == nuevaNota) {
            try {
                File file = new File(path);
                if (!file.isFile()) {
                    String mensaje = JOptionPane.showInputDialog("Nombre nota");

                    gestorArchivos.crearArchivo(file.getPath() + "\\" + mensaje);
                    this.tree1.updateUI();
                }


            } catch (NullPointerException e1) {
                System.err.println("Error al crear la nota");
            }


        }


        if (e.getSource() == nuevaCarpeta) {

            try {
                File file = new File(path);

                if (!file.isFile()) {
                    String mensaje = JOptionPane.showInputDialog("Nombre Carpeta");
                    gestorArchivos.crearDirectorio(file.getPath() + "\\" + mensaje);
                    this.tree1.updateUI();
                }
            } catch (NullPointerException e1) {
                System.err.println("Error al crear la carpeta");
            }


        }

        if (e.getSource() == eliminarNota) {
            try {
                File file = new File(path);

                if (file.isFile()) {
                    gestorArchivos.eliminarArchivos(file.getPath());
                    this.tree1.updateUI();

                }
            } catch (NullPointerException e1) {
                System.err.println("No se puede eliminar la nota");
            }


        }
        if (e.getSource() == eliminarCarpeta) {
            try {
                File file = new File(path);

                if (file.isDirectory() || path.equals(ruta)) {
                    gestorArchivos.eliminarCarpeta(file.getPath());
                    this.tree1.updateUI();
                }
            } catch (NullPointerException e1) {
                System.err.println("Error al eliminar la carpeta");
            }

        }

    }

    private String validarPath() {
        var path = String.valueOf(tree1.getAnchorSelectionPath());
        String aux = path.substring(path.indexOf(",") + 2);


        if (path.contains("]")) {
            path = path.substring(0, path.indexOf("]"));
            aux = aux.substring(0, aux.indexOf("]"));
        }

        if (path.contains("[")) {
            path = path.replace("[", "");
        }
        if (path.contains(",")) {
            path = path.substring(0, path.indexOf(","));

        }
        if (aux.contains(",")) {
            aux = aux.substring(0, aux.indexOf(",")) + "\\" + aux.substring(aux.indexOf(",") + 2);
        }

        if (path.equals(aux)) {
            return path;
        } else {
            path = path + "\\" + aux;
        }

        return path;
    }


    /**
     * Method generated by IntelliJ IDEA GUI Designer
     * >>> IMPORTANT!! <<<
     * DO NOT edit this method OR call it in your code!
     *
     * @noinspection ALL
     */
    private void $$$setupUI$$$() {
        principal = new JPanel();
        principal.setLayout(new com.intellij.uiDesigner.core.GridLayoutManager(3, 5, new Insets(0, 0, 0, 0), -1, -1));
        principal.setOpaque(true);
        principal.setPreferredSize(new Dimension(400, 500));
        final com.intellij.uiDesigner.core.Spacer spacer1 = new com.intellij.uiDesigner.core.Spacer();
        principal.add(spacer1, new com.intellij.uiDesigner.core.GridConstraints(0, 3, 1, 1, com.intellij.uiDesigner.core.GridConstraints.ANCHOR_CENTER, com.intellij.uiDesigner.core.GridConstraints.FILL_HORIZONTAL, com.intellij.uiDesigner.core.GridConstraints.SIZEPOLICY_WANT_GROW, 1, null, null, null, 0, false));
        final com.intellij.uiDesigner.core.Spacer spacer2 = new com.intellij.uiDesigner.core.Spacer();
        principal.add(spacer2, new com.intellij.uiDesigner.core.GridConstraints(1, 0, 2, 1, com.intellij.uiDesigner.core.GridConstraints.ANCHOR_CENTER, com.intellij.uiDesigner.core.GridConstraints.FILL_VERTICAL, 1, com.intellij.uiDesigner.core.GridConstraints.SIZEPOLICY_WANT_GROW, null, null, null, 0, false));
        tree1 = new JTree();
        principal.add(tree1, new com.intellij.uiDesigner.core.GridConstraints(1, 1, 2, 4, com.intellij.uiDesigner.core.GridConstraints.ANCHOR_CENTER, com.intellij.uiDesigner.core.GridConstraints.FILL_BOTH, com.intellij.uiDesigner.core.GridConstraints.SIZEPOLICY_WANT_GROW, com.intellij.uiDesigner.core.GridConstraints.SIZEPOLICY_WANT_GROW, null, new Dimension(100, 10), null, 0, false));
    }

    /**
     * @noinspection ALL
     */
    public JComponent $$$getRootComponent$$$() {
        return principal;
    }


    private void createUIComponents() {
        // TODO: place custom component creation code here
    }

    /**
     * Invoked when the mouse button has been clicked (pressed
     * and released) on a component.
     *
     * @param e the event to be processed
     */
    @Override
    public void mouseClicked(MouseEvent e) {
        String path = validarPath();
        File file = new File(path);
        if (file.isFile()) {
            textEditor = new TextEditor(path);
            textEditor.abrirArchivo();
        }

    }

    public void mousePressed(MouseEvent e) {

    }

    public void mouseReleased(MouseEvent e) {

    }

    public void mouseEntered(MouseEvent e) {

    }

    public void mouseExited(MouseEvent e) {

    }

}
